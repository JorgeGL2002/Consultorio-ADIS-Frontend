<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="assets/logocorto.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <title>Confirma tu cita | Fundación ADIS</title>
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="assets/logocorto.png" width="48px" height="48px" alt="Logo pequeño de la fundacion">
            </a>
        </div>
    </nav>
    <div class="container mt-4">
        <div class="container mt-5">
            <div class="card shadow-lg p-4 rounded-4" style="max-width: 600px; margin: auto;">
                <div class="text-center mb-4">
                    <img src="assets/logocorto.png" width="48px" height="48px" alt="Logo de la fundación ADIS" />
                </div>
                <h3 class="text-center text-primary fw-bold mb-4">Confirma tu cita</h3>
                <div class="mb-3 d-flex justify-content-center align-items-center">
                    <button type="button" id="confirmar" class="btn btn-success w-100">Confirmar</button>
                    <button type="button" id="cancelar" class="btn btn-danger w-100 ms-2">Cancelar</button>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <h5 class="fw-bold">Detalles de la cita</h5>
            <p><b>Fecha:</b><span id="fechaCita"></span></p>
            <p><b>Hora:</b> <span id="horaCita"></span></p>
            <p><b>Servicio :</b> <span id="servicioCita"></span></p>
            <p><b>Costo:</b> <span id="costoCita"></span></p>
            <p><b>Profesional:</b> <span id="profesionalCita"></span></p>
        </div>
    </div>

    <div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 5; max-width: 220px;">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
            <symbol id="check-circle-fill" viewBox="0 0 16 16" style="width: 20px; margin-right: 8px;">
                <path
                    d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
            </symbol>
            <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16" style="width: 20px; margin-right: 8px;">
                <path
                    d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
            </symbol>
        </svg>
    </div>
    <script>
        async function detallesCita(idCita) {
            try {
                const response = await fetch(`https://api-railway-production-24f1.up.railway.app/api/test/detallesCitaEnlace?idCita=${idCita}`);
                if (!response.ok) {
                    throw new Error('Error en la respuesta de la red');
                }
                const data = await response.json();
                console.log(data);
                document.getElementById("fechaCita").textContent = data.fecha;
                document.getElementById("horaCita").textContent = data.hora;
                document.getElementById("servicioCita").textContent = data.nombreServicio;
                document.getElementById("costoCita").textContent = data.cuota;
                document.getElementById("profesionalCita").textContent = data.nombreProfesional;
            } catch (error) {
                console.error('Error al obtener los detalles de la cita:', error);
                mostrarAlerta('danger', 'Error al obtener los detalles de la cita');
            }

        }

        function mostrarAlerta(tipo, mensaje) {
            const iconos = {
                success: "check-circle-fill",
                warning: "exclamation-triangle-fill",
                danger: "exclamation-triangle-fill",
                info: "info-fill"
            };

            const colores = {
                success: "text-success",
                warning: "text-warning",
                danger: "text-danger",
                info: "text-info"
            };

            const alerta = document.createElement("div");
            alerta.className = `alert alert-${tipo} alert-dismissible fade show d-flex align-items-center mt-2`;
            alerta.style.maxWidth = "800px";
            alerta.style.fontSize = "0.9rem";
            alerta.style.wordWrap = "break-word";
            alerta.style.paddingTop = "70px";

            alerta.innerHTML = `
    <svg class="bi flex-shrink-0 me-2 ${colores[tipo]}" width="20" height="20" role="img" aria-label="${tipo}">
        <use xlink:href="#${iconos[tipo]}"/>
    </svg>
    <div>${mensaje}</div>
    <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
  `;

            document.getElementById("alertContainer").appendChild(alerta);

            setTimeout(() => {
                alerta.classList.remove("show");
                alerta.classList.add("hide");
                setTimeout(() => alerta.remove(), 500);
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const idCita = urlParams.get('idCita');
            if (idCita) {
                detallesCita(idCita);
            } else {
                mostrarAlerta('danger', 'Token no proporcionado.');
            }

            document.getElementById('confirmar').addEventListener('click', function () {
                if (idCita) {
                    fetch(`https://api-railway-production-24f1.up.railway.app/api/test/confirmarCitaEnlace?idCita=${idCita}`, {
                        method: 'PUT'
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                mostrarAlerta('success', 'Cita confirmada exitosamente.');
                                setTimeout(() => window.location.href = '/', 2000);
                            } else {
                                mostrarAlerta('warning', 'Error al confirmar la cita');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            mostrarAlerta('danger', 'Error al confirmar la cita');
                        });
                } else {
                    mostrarAlerta('danger', 'ID no proporcionado.');
                }
            });

            document.getElementById('cancelar').addEventListener('click', function () {
                if (idCita) {
                    fetch(`https://api-railway-production-24f1.up.railway.app/api/test/cancelarCitaEnlace?idCita=${idCita}`, {
                        method: 'PUT'
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                mostrarAlerta('success', 'Cita cancelada.');
                                setTimeout(() => window.location.href = '/', 2000);
                            } else {
                                mostrarAlerta('warning', 'Error al cancelar la cita');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            mostrarAlerta('danger', 'Error al cancelar la cita');
                        });
                } else {
                    mostrarAlerta('danger', 'ID no proporcionado.');
                }
            });
        });
    </script>
</body>

</html>